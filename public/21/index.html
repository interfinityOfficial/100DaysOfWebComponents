<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="/assets/icon.png" />
    <title>Day 21/100</title>
  </head>
  <body>
    <main id="html-clock">
      <div class="clock">
        <div class="digit" id="digit-1-1">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-1-2">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-1-3">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-1-4">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-1-5">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-1-6">
          <div class="circle"></div>
          <div class="square"></div>
        </div>

        <div class="digit" id="digit-2-1">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-2-2">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-2-3">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-2-4">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-2-5">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-2-6">
          <div class="circle"></div>
          <div class="square"></div>
        </div>

        <div class="digit" id="digit-3-1">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-3-2">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-3-3">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-3-4">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-3-5">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-3-6">
          <div class="circle"></div>
          <div class="square"></div>
        </div>

        <div class="digit" id="digit-4-1">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-4-2">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-4-3">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-4-4">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-4-5">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-4-6">
          <div class="circle"></div>
          <div class="square"></div>
        </div>

        <div class="digit" id="digit-5-1">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-5-2">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-5-3">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-5-4">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-5-5">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
        <div class="digit" id="digit-5-6">
          <div class="circle"></div>
          <div class="square"></div>
        </div>
      </div>
    </main>

    <div id="matter-canvas"></div>

    <style>
      body {
        margin: 0;
        overflow: hidden;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100vw;
        height: 100vh;
        background-color: #000;
        cursor: pointer;
      }

      .instruction {
        position: absolute;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        color: #666;
        font-family: monospace;
        font-size: 14px;
        z-index: 10;
      }

      main {
        width: 100vw;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;

        transition: background-color 0.5s ease-in-out;
      }

      .clock {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        grid-template-rows: repeat(5, 1fr);
        gap: min(1vw, 1vh);
      }

      .digit {
        position: relative;
        width: min(12vw, 12vh);
        aspect-ratio: 1 / 1;
        transform-style: preserve-3d;
        transition: transform 0.5s ease-in-out;
      }

      .circle,
      .square {
        position: absolute;
        width: 100%;
        height: 100%;
        left: 0;
        top: 0;
        background-color: #fff;
        -webkit-backface-visibility: hidden;
        backface-visibility: hidden;
      }

      .circle {
        border-radius: 100%;
        transform: rotateX(180deg);
      }

      .dash {
        transform: rotateX(0deg);
      }

      .dot {
        transform: rotateX(180deg);
      }

      #matter-canvas {
        display: none;
        width: 100vw;
        height: 100vh;
      }

      #matter-canvas canvas {
        display: block;
        width: 100%;
        height: 100%;
      }
    </style>

    <script src="/lib/matter.min.js"></script>
    <script>
      window.onload = () => {
        // Morse code mapping for digits 0-9
        function digitToMorse(digit) {
          const morseCodes = {
            0: "-----",
            1: ".----",
            2: "..---",
            3: "...--",
            4: "....-",
            5: ".....",
            6: "-....",
            7: "--...",
            8: "---..",
            9: "----.",
          };
          return morseCodes[digit] || "-----";
        }

        // HTML Clock Update Function
        let clockInterval;

        function updateHTMLClock() {
          const now = new Date();
          let hours = now.getHours();
          let minutes = now.getMinutes();
          let seconds = now.getSeconds();

          // Convert to 12-hour format
          if (hours > 12) hours -= 12;
          if (hours === 0) hours = 12;

          // Convert to strings and pad
          const hoursStr = String(hours).padStart(2, "0");
          const minutesStr = String(minutes).padStart(2, "0");
          const secondsStr = String(seconds).padStart(2, "0");

          // Get individual digits
          const digits = [
            hoursStr[0],
            hoursStr[1],
            minutesStr[0],
            minutesStr[1],
            secondsStr[0],
            secondsStr[1],
          ];

          // Update each column based on Morse code
          for (let col = 0; col < 6; col++) {
            const morse = digitToMorse(digits[col]);

            for (let row = 0; row < 5; row++) {
              const digitElement = document.getElementById(
                `digit-${row + 1}-${col + 1}`
              );
              if (morse[row] === ".") {
                digitElement.classList.remove("dash");
                digitElement.classList.add("dot");
              } else {
                digitElement.classList.remove("dot");
                digitElement.classList.add("dash");
              }
            }
          }
        }

        // Start HTML clock
        updateHTMLClock();
        clockInterval = setInterval(updateHTMLClock, 1000);

        // Matter.js Setup (initially hidden)
        let engine,
          render,
          circleBodies = [],
          squareBodies = [];

        function initMatterJS() {
          // Matter.js module aliases
          const Engine = Matter.Engine,
            Render = Matter.Render,
            World = Matter.World,
            Bodies = Matter.Bodies,
            Body = Matter.Body,
            Runner = Matter.Runner;

          // Create engine with gravity
          engine = Engine.create();
          engine.world.gravity.y = 0.8; // Enable gravity

          // Create renderer
          const canvasElement = document.getElementById("matter-canvas");

          // Clear any existing content
          canvasElement.innerHTML = "";

          render = Render.create({
            element: canvasElement,
            engine: engine,
            options: {
              width: window.innerWidth,
              height: window.innerHeight,
              wireframes: false,
              background: "#000",
            },
          });

          // Create bodies based on current HTML clock state
          const cols = 6;
          const rows = 5;
          const digitSize = Math.min(
            0.12 * window.innerWidth,
            0.12 * window.innerHeight
          );
          const gap = Math.min(
            0.01 * window.innerWidth,
            0.01 * window.innerHeight
          );

          // Calculate positions (matching HTML layout)
          const totalWidth = cols * digitSize + (cols - 1) * gap;
          const totalHeight = rows * digitSize + (rows - 1) * gap;
          const startX = (window.innerWidth - totalWidth) / 2 + digitSize / 2;
          const startY = (window.innerHeight - totalHeight) / 2 + digitSize / 2;

          // Create walls to contain the bodies
          const wallThickness = 50;
          const ground = Bodies.rectangle(
            window.innerWidth / 2,
            window.innerHeight + wallThickness / 2,
            window.innerWidth,
            wallThickness,
            { isStatic: true, render: { visible: false } }
          );
          const leftWall = Bodies.rectangle(
            -wallThickness / 2,
            window.innerHeight / 2,
            wallThickness,
            window.innerHeight,
            { isStatic: true, render: { visible: false } }
          );
          const rightWall = Bodies.rectangle(
            window.innerWidth + wallThickness / 2,
            window.innerHeight / 2,
            wallThickness,
            window.innerHeight,
            { isStatic: true, render: { visible: false } }
          );
          const ceiling = Bodies.rectangle(
            window.innerWidth / 2,
            -wallThickness / 2,
            window.innerWidth,
            wallThickness,
            { isStatic: true, render: { visible: false } }
          );

          World.add(engine.world, [ground, leftWall, rightWall, ceiling]);

          for (let row = 0; row < rows; row++) {
            for (let col = 0; col < cols; col++) {
              const x = startX + col * (digitSize + gap);
              const y = startY + row * (digitSize + gap);

              // Check current HTML state to determine which shape to show
              const digitElement = document.getElementById(
                `digit-${row + 1}-${col + 1}`
              );
              const isDot = digitElement.classList.contains("dot");

              // Create only the visible body for physics
              let body;
              if (isDot) {
                // Create circle body
                body = Bodies.circle(x, y, digitSize / 2, {
                  render: {
                    fillStyle: "#fff",
                    visible: true,
                  },
                  isStatic: false, // Dynamic for physics - will fall immediately
                  restitution: 0.8,
                  friction: 0.1,
                });
                circleBodies.push(body);
                squareBodies.push(null); // Placeholder for consistent indexing
              } else {
                // Create square body
                body = Bodies.rectangle(x, y, digitSize, digitSize, {
                  render: {
                    fillStyle: "#fff",
                    visible: true,
                  },
                  isStatic: false, // Dynamic for physics - will fall immediately
                  restitution: 0.8,
                  friction: 0.1,
                });
                squareBodies.push(body);
                circleBodies.push(null); // Placeholder for consistent indexing
              }

              // Apply small initial velocity to ensure they start moving
              Body.setVelocity(body, {
                x: (Math.random() - 0.5) * 2,
                y: Math.random() * 2,
              });

              // Make sure the body is awake and will move
              body.isSleeping = false;

              World.add(engine.world, body);
            }
          }

          // Start the engine and renderer
          const runner = Runner.create({
            delta: 1000 / 60, // 60 FPS
          });
          Runner.run(runner, engine);
          Render.run(render);
        }

        // Click handler to switch modes
        let isMatterMode = false;

        document.addEventListener("click", (event) => {
          if (!isMatterMode) {
            // Switch to Matter.js mode
            const htmlClock = document.getElementById("html-clock");
            const matterCanvas = document.getElementById("matter-canvas");

            htmlClock.style.display = "none";
            matterCanvas.style.display = "block";

            // Stop HTML clock updates
            clearInterval(clockInterval);

            // Initialize Matter.js with current state
            initMatterJS();

            isMatterMode = true;
          }
        });

        // Note: Window resizing in physics mode is not implemented for simplicity
      };
    </script>
  </body>
</html>
